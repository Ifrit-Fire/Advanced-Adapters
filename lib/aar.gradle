//Copied from https://github.com/blundell/release-android-library

apply plugin: 'maven'

def groupId = project.PUBLISH_GROUP_ID
def artifactId = project.PUBLISH_ARTIFACT_ID
def version = project.PUBLISH_VERSION_NAME
def localReleaseDest = "${buildDir}/release/${version}"

task javadoc(type: Javadoc) {
	source = android.sourceSets.main.java.srcDirs
	classpath += files(android.getBootClasspath())
}

task javadocJar(type: Jar, dependsOn: javadoc) {
	classifier = 'javadoc'
	from javadoc.destinationDir
}

task sourcesJar(type: Jar) {
	classifier = 'sources'
	from android.sourceSets.main.java.srcDirs
}

uploadArchives {
	repositories.mavenDeployer {
		pom.groupId = groupId
		pom.artifactId = artifactId
		pom.version = version
		// Add other pom properties here if you want (developer details / licenses)
		repository(url: "file://${localReleaseDest}")
	}
}

task zipRelease(type: Zip) {
	from localReleaseDest
	destinationDir buildDir
	archiveName "release-${version}.zip"
}

task generateRelease << {
	println "Release ${version} can be found at ${localReleaseDest}/"
	println "Release ${version} zipped can be found ${buildDir}/release-${version}.zip"
}

generateRelease.dependsOn(uploadArchives)
generateRelease.dependsOn(zipRelease)

artifacts {
	archives javadocJar
	archives sourcesJar
}